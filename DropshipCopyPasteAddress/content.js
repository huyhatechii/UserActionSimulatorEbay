var doFilter=function(){if("feedback.ebay.com"===window.location.hostname||-1<document.URL.indexOf("PurchaseHistory")){var e=getQueryVariable("userid");console.log(e),chrome.storage.sync.get("data_user_id",function(t){void 0===t.data_user_id&&chrome.storage.sync.set({data_user_id:e},function(){})}),chrome.storage.sync.get("data",function(e){var t=e.data;if(void 0===t&&(t=[]),"feedback.ebay.com"===window.location.hostname){e=document.getElementsByClassName("mbg-nw");for(var a=1;a<e.length;a++)-1==t.indexOf(e[a].innerText)&&t.push(e[a].innerText)}if(-1<document.URL.indexOf("PurchaseHistory"))for(e=document.getElementsByClassName("seller-id"),a=0;a<e.length;a++)-1==t.indexOf(e[a].innerText)&&t.unshift(e[a].innerText);chrome.storage.sync.get("data_user_id",function(e){(e.data_user_id===getQueryVariable("userid")||-1<document.URL.indexOf("PurchaseHistory"))&&chrome.storage.sync.set({data:t},function(){})})})}if("k2b-bulk.ebay.com"===window.location.hostname){for(var t=document.querySelectorAll("#RecordNumber div a"),a=[],n=0;n<t.length;n++){var i=t[n].getAttribute("href");a.push(i)}chrome.storage.sync.get("data_active",function(e){if("1"==e.data_active){var t=$.when({});$.each(a,function(e,a){var n;t=t.then((n=a,function(){var e=$.Deferred(),t=$("#RecordNumber div a[href='"+n+"']");return $.ajax({url:n,cache:!0,method:"GET"}).success(function(e){var a=$(e);e=$("#buyercontactname",a).val();var n=$("#buyeraddress1",a).val(),i=$("#buyeraddress2",a).val(),o=$("#buyercity",a).val(),s=$("#buyerstateprovince",a).val();void 0===(s=list_state_usa(s))&&(s=$("#buyerstateprovince",a).val());var r=$("#buyerzip",a).val(),c=$("#buyercountry option:selected",a).text(),d=$("#dayphone1",a).val();null!=$("#dayphone2",a).val()&&(d+=$("#dayphone2",a).val()),null!=$("#dayphone3",a).val()&&(d+=$("#dayphone3",a).val()),null!=$("#dayphone4",a).val()&&""!==(a=$("#dayphone4",a).val())&&(d=d+" ext:"+a),a=JSON.stringify({buyercontactname:e,buyeraddress1:n,buyeraddress2:i,buyercity:o,buyerstateprovince:s,buyerzip:r,buyercountry:c,phone:d}),n='<span class="shipping-ebay-addr"><span class="shipping-ebay-name">'+e+"</span><br>"+n,""!==i&&(n+="<br>"+i),n+="<br>"+o+" "+s+" "+r+"<br>"+c+"<br>"+d+"<br></span>",$(t).parent().parent().parent().parent().next().find("td[id^='LineActions']").html(n),$(t).parent().parent().parent().parent().next().find("td[id^='RecordNumber']").html('<button style="width:100%" type="button" class="btn-copy-info btn btn-success btn-xs" data-json="'+encodeURIComponent(a)+'">Copy infomation</button><div class="clearfix"></div><button style="width:100%;margin-top:10px;font-size:10px" data-fullname="'+e+'" type="button" class="btn-send-mess btn btn-success btn-xs" data-loading-text="Sending...">Send msg after add tracking id</button><div class="clearfix"></div><button style="width:100%;margin-top:10px;font-size:10px" data-fullname="'+e+'" type="button" class="btn-send-mess2 btn btn-success btn-xs" data-loading-text="Sending...">Send msg after delivery</button>'),console.log("Run ajax and got data")}),e.resolve(),e.promise()}))})}}),chrome.storage.sync.get("data_active",function(e){$(document).on("click",".btn-copy-info",function(){if("1"==e.data_active){var t=decodeURIComponent($(this).attr("data-json"));t=$.parseJSON(t),chrome.storage.sync.set({data2:t},function(){}),console.log(t),$(this).notify("Copy successfully",{position:"top",className:"success"})}else $(this).notify("Please active license for this feature :P",{position:"top",className:"error"})})}),chrome.storage.sync.get("data_active",function(e){chrome.storage.sync.get("messagebuyertemplate",function(t){$(document).on("click",".btn-send-mess",function(){if("1"==e.data_active){var a=$(this).parent().parent().parent().prev().find("td[id^='LineActions'] a[title^='Contact buyer']").attr("href");a=new URLSearchParams(a).get("requested");var n=$(this).parent().parent().parent().prev().find("td[id^='LineActions'] a").attr("href"),i=new URLSearchParams(n);n=i.get("itemId"),i=i.get("transid");var o=$(this).attr("data-fullname").split(" ")[0],s=$(this).parent().next().next().find("a[style^='font-size:x-small;font-family:verdana']").text();if(""!=s){var r=t.messagebuyertemplate;r=r.replace("{FIRSTNAME}",o),""!=s&&(r=r.replace("{TRACKINGNUMBER}",s));var c=this;a={cat:"-99",recipient:a,iId:n,actn:"submit",msg_cnt:r,msg_cnt_cnt:r,RTWLog:"",imageUrls:"",picfile:"",sendBtn:"Send"},console.log(a),$(this).attr("disabled",!0),$(this).text("Sending..."),$.ajax({url:"http://contact.ebay.com/ws/eBayISAPI.dll?ContactUserNextGen",method:"POST",data:a,success:function(){$(c).notify("Msg sent!",{position:"top",className:"success"}),$(c).attr("disabled",!1),$(c).text("Send msg after add tracking id")},fail:function(){$(c).notify("Msg not sent!",{position:"top",className:"error"}),$(c).attr("disabled",!1),$(c).text("Send msg after add tracking id")}}),o="Msg SENT after add tracking id",""!=(a=$(this).parent().parent().next().find("span[style^='white-space:normal']").text())&&(o=", Msg SENT after add tracking id"),console.log(a),console.log(o),$.ajax({url:"http://k2b-bulk.ebay.com/V4Ajax",method:"POST",traditional:!0,data:{svcid:"ITEM_NOTE_SERVICE",v:0,reqttype:"JSON",resptype:"JSON",clientType:"Safari:537:",request:JSON.stringify({action:"SAVE",transactionId:[i],itemId:[n],notes:[a+o],operation:"edit",noteSpanId:n+"+"+i+"_user_note",panelId:"Cadd_note_panel_id"})},success:function(){},fail:function(){}})}else $(this).notify("Please add tracking before press send message",{position:"top",className:"warn"})}else $(this).notify("Please active license for this feature :P",{position:"top",className:"error"})})})}),chrome.storage.sync.get("data_active",function(e){chrome.storage.sync.get("messagebuyertemplate2",function(t){$(document).on("click",".btn-send-mess2",function(){if("1"==e.data_active){var a=$(this).parent().parent().parent().prev().find("td[id^='LineActions'] a[title^='Contact buyer']").attr("href");a=new URLSearchParams(a).get("requested");var n=$(this).parent().parent().parent().prev().find("td[id^='LineActions'] a").attr("href"),i=new URLSearchParams(n);n=i.get("itemId"),i=i.get("transid"),$(this).attr("data-fullname").split(" "),$(this).parent().next().next().find("a[style^='font-size:x-small;font-family:verdana']").text();var o=t.messagebuyertemplate2,s=this;a={cat:"-99",recipient:a,iId:n,actn:"submit",msg_cnt:o,msg_cnt_cnt:o,RTWLog:"",imageUrls:"",picfile:"",sendBtn:"Send"},console.log(a),$(this).attr("disabled",!0),$(this).text("Sending..."),$.ajax({url:"http://contact.ebay.com/ws/eBayISAPI.dll?ContactUserNextGen",method:"POST",data:a,success:function(){$(s).notify("Msg sent!",{position:"top",className:"success"}),$(s).attr("disabled",!1),$(s).text("Send msg after delivery")},fail:function(){$(s).notify("Msg not sent!",{position:"top",className:"error"}),$(s).attr("disabled",!1),$(s).text("Send msg after delivery")}}),o="Msg SENT after delivery",""!=(a=$(this).parent().parent().next().find("span[style^='white-space:normal']").text())&&(o=", Msg SENT after delivery"),console.log(a),console.log(o),$.ajax({url:"http://k2b-bulk.ebay.com/V4Ajax",method:"POST",traditional:!0,data:{svcid:"ITEM_NOTE_SERVICE",v:0,reqttype:"JSON",resptype:"JSON",clientType:"Safari:537:",request:JSON.stringify({action:"SAVE",transactionId:[i],itemId:[n],notes:[a+o],operation:"edit",noteSpanId:n+"+"+i+"_user_note",panelId:"Cadd_note_panel_id"})},success:function(){},fail:function(){}})}else $(this).notify("Please active license for this feature :P",{position:"top",className:"error"})})})})}"shoppingcart.aliexpress.com"===window.location.hostname&&chrome.storage.sync.get("data_active",function(e){chrome.runtime.error||"1"!=e.data_active||($(".p-message").append('<div class="clearfix"></div><button type="button" class="btn-paste-note btn btn-success btn-sm">Fill note</button>'),$(".address-title").append('<div class="clearfix"></div><button type="button" class="btn-paste-info btn btn-success btn-sm">Paste infomation</button>'),$(".p-message").on("click",".btn-paste-note",function(){chrome.storage.sync.get("data_note",function(e){if(!chrome.runtime.error){var t=e.data_note;void 0===t&&(t="Please DO NOT POST the INVOICE on the PACKAGE and ship the item as soon as possible. Thank you very much!"),$("textarea").each(function(e){document.getElementsByTagName("textarea")[e].value=t})}})}),$(".address-title").on("click",".btn-paste-info",function(){$(".sa-edit").trigger("click"),chrome.storage.sync.get("data2",function(e){if(!chrome.runtime.error){var t=e.data2;document.getElementsByName("contactPerson")[0].value=t.buyercontactname;var a=document.getElementsByClassName("sa-country")[0].options,i=t.buyercountry;for(e="",n=0;n<a.length;n++)if(-1<a[n].text.indexOf(i)){e=a[n].value;break}(a=document.querySelector(".sa-country")).value=e,console.log(e),(e=document.createEvent("HTMLEvents")).initEvent("change",!0,!0),a.dispatchEvent(e),document.getElementsByName("address")[0].value=t.buyeraddress1,document.getElementsByName("address2")[0].value=t.buyeraddress2,document.getElementsByName("city")[0].value=t.buyercity,document.getElementsByName("zip")[0].value=t.buyerzip;var o=document.getElementsByName("mobileNo");""==t.phone?chrome.storage.sync.get("data_phonedefault",function(e){chrome.runtime.error||(o[0].value=e.data_phonedefault)}):o[0].value=t.phone,setTimeout(function(){var e=document.getElementsByClassName("ui-textfield-system")[5].options,a=t.buyerstateprovince,i="";for(n=0;n<e.length;n++)if(-1<e[n].text.indexOf(a)){i=e[n].value;break}(e=document.querySelector(".sa-province-wrapper select.ui-textfield-system")).value=i,console.log(e),(i=document.createEvent("HTMLEvents")).initEvent("change",!0,!0),e.dispatchEvent(i),"display: none;"==e.getAttribute("style")&&(document.querySelector(".sa-province-wrapper input.ui-textfield-system").value=a)},2e3)}}),$(this).notify("Paste successfully",{position:"top",className:"success"})}))})};function getQueryVariable(e){for(var t=window.location.search.substring(1).split("&"),a=0;a<t.length;a++){var n=t[a].split("=");if(n[0]==e)return n[1]}return!1}function list_state_usa(e){for(var t=[{name:"Alabama",abbreviation:"AL"},{name:"Alaska",abbreviation:"AK"},{name:"American Samoa",abbreviation:"AS"},{name:"Arizona",abbreviation:"AZ"},{name:"Arkansas",abbreviation:"AR"},{name:"California",abbreviation:"CA"},{name:"Colorado",abbreviation:"CO"},{name:"Connecticut",abbreviation:"CT"},{name:"Delaware",abbreviation:"DE"},{name:"District Of Columbia",abbreviation:"DC"},{name:"Federated States Of Micronesia",abbreviation:"FM"},{name:"Florida",abbreviation:"FL"},{name:"Georgia",abbreviation:"GA"},{name:"Guam",abbreviation:"GU"},{name:"Hawaii",abbreviation:"HI"},{name:"Idaho",abbreviation:"ID"},{name:"Illinois",abbreviation:"IL"},{name:"Indiana",abbreviation:"IN"},{name:"Iowa",abbreviation:"IA"},{name:"Kansas",abbreviation:"KS"},{name:"Kentucky",abbreviation:"KY"},{name:"Louisiana",abbreviation:"LA"},{name:"Maine",abbreviation:"ME"},{name:"Marshall Islands",abbreviation:"MH"},{name:"Maryland",abbreviation:"MD"},{name:"Massachusetts",abbreviation:"MA"},{name:"Michigan",abbreviation:"MI"},{name:"Minnesota",abbreviation:"MN"},{name:"Mississippi",abbreviation:"MS"},{name:"Missouri",abbreviation:"MO"},{name:"Montana",abbreviation:"MT"},{name:"Nebraska",abbreviation:"NE"},{name:"Nevada",abbreviation:"NV"},{name:"New Hampshire",abbreviation:"NH"},{name:"New Jersey",abbreviation:"NJ"},{name:"New Mexico",abbreviation:"NM"},{name:"New York",abbreviation:"NY"},{name:"North Carolina",abbreviation:"NC"},{name:"North Dakota",abbreviation:"ND"},{name:"Northern Mariana Islands",abbreviation:"MP"},{name:"Ohio",abbreviation:"OH"},{name:"Oklahoma",abbreviation:"OK"},{name:"Oregon",abbreviation:"OR"},{name:"Palau",abbreviation:"PW"},{name:"Pennsylvania",abbreviation:"PA"},{name:"Puerto Rico",abbreviation:"PR"},{name:"Rhode Island",abbreviation:"RI"},{name:"South Carolina",abbreviation:"SC"},{name:"South Dakota",abbreviation:"SD"},{name:"Tennessee",abbreviation:"TN"},{name:"Texas",abbreviation:"TX"},{name:"Utah",abbreviation:"UT"},{name:"Vermont",abbreviation:"VT"},{name:"Virgin Islands",abbreviation:"VI"},{name:"Virginia",abbreviation:"VA"},{name:"Washington",abbreviation:"WA"},{name:"West Virginia",abbreviation:"WV"},{name:"Wisconsin",abbreviation:"WI"},{name:"Wyoming",abbreviation:"WY"}],a=0;a<t.length;a++)if(e===t[a].abbreviation)return t[a].name}$(window).load(function(){doFilter(document.body)});